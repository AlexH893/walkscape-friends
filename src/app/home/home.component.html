<div class="center">
  <div><h1>WalkScape Friend Finder</h1></div>
  <p class="blurb">
    Submit your username and copy usernames to add in WalkScape.<br />
  </p>

  <div class="inline-container">
    <img id="one" src="../../assets/one.png" tooltip="first" alt="first step" />
    <form [formGroup]="friendForm">
      <mat-form-field
        [ngClass]="{
          'mat-form-field-invalid':
            friendForm.get('username')?.invalid &&
            friendForm.get('username')?.touched,
          'mat-form-field-valid':
            friendForm.get('username')?.valid ||
            !friendForm.get('username')?.touched
        }"
      >
        <mat-label class="small-label">Username</mat-label>
        <input
          matInput
          type="text"
          formControlName="username"
          maxlength="12"
          autofocus
          autocomplete="on"
          id="usernameInput"
          (keydown)="restrictSpecialCharacters($event)"
        />
        <!-- Error message for required validation -->
        <mat-error
          *ngIf="
            friendForm.get('username')?.touched &&
            friendForm.get('username')?.hasError('required')
          "
        >
          Username is required
        </mat-error>
        <!-- Error message for pattern validation -->
        <mat-error
          *ngIf="
            friendForm.get('username')?.touched &&
            friendForm.get('username')?.hasError('pattern')
          "
        >
          No special characters
        </mat-error>
      </mat-form-field>
    </form>
  </div>

  <div class="inline-container">
    <img id="two" src="../../assets/two.png" alt="second step" />
    <form [formGroup]="stepForm">
      <mat-form-field>
        <mat-label class="small-label">Avg Steps Per Day</mat-label>
        <input
          tabindex="0"
          matInput
          type="number"
          formControlName="steps"
          class="input__field"
          autofocus
          autocomplete="on"
          id="stepsInput"
        />
      </mat-form-field>
    </form>
  </div>

  <div class="inline-container">
    <img id="three" src="../../assets/three.png" alt="third step" />
    <mat-form-field>
      <mat-label class="small-label">Region</mat-label>
      <input
        tabindex="0"
        type="text"
        aria-label="Region"
        matInput
        required="false"
        [formControl]="regionForm"
        [matAutocomplete]="auto"
        placeholder="Type & select your country"
        id="regionInput"
      />
      <mat-autocomplete #auto="matAutocomplete">
        <mat-option
          *ngFor="let option of filteredJSONDataOptions | async"
          [value]="option.region"
        >
          {{ option.name }}
        </mat-option>
      </mat-autocomplete>
    </mat-form-field>
  </div>

  <!-- Submit button -->
  <button
    (click)="submitUsername()"
    [disabled]="friendForm.invalid"
    id="submitBtn"
    tabindex="0"
  >
    Submit
  </button>

  <!-- Username Column -->
  <table mat-table [dataSource]="usernames" class="mat-elevation-z8 center2">
    <ng-container matColumnDef="username">
      <th
        mat-header-cell
        *matHeaderCellDef
        class="th"
        style="white-space: nowrap"
      >
        Recently submitted usernames
        <br />
        <span style="font-size: 0.7em" id="toCopy"
          >Click/tap a username to copy</span
        >
      </th>
      <td
        mat-cell
        *matCellDef="let username"
        value="username"
        id="usernameCell"
        class="username"
        style="cursor: auto"
      >
        <a
          style="cursor: pointer"
          [cdkCopyToClipboard]="username.username"
          (click)="
            copySnackbar('Username copied to clipboard', 'Dismiss', 1000)
          "
          class="usernameTxt"
          id="username"
          >{{ username.username }}</a
        >

        &nbsp;
        <div id="details" style="cursor: auto">
          <!-- <a class="region">{{ username.name }}</a> -->

          <a class="date">{{ username.createdAt }}</a>
          <a class="regionTxt">{{ username.region }}</a>
          <a class="stepsTxt" *ngIf="username.steps">
            {{ username.steps + " steps per day" }}
          </a>
        </div>
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
  </table>
  <mat-paginator
    [pageSizeOptions]="[10, 20, 50, 100]"
    aria-label="Select page of users"
    style="margin: 0 auto"
  ></mat-paginator>
</div>
